\chapter{Related Works} % Main chapter title

\label{chapter:relatework} % Change X to a consecutive number; for referencing this chapter elsewhere, use \ref{ChapterX}

In this section, we first review both theory-driven and data-driven literatures on the relationship between player engagement and game outcomes. Then, we review existing endeavors for applying recommendation systems in video games.

\section{Game Outcomes and Player Engagement}
The primary motivation of this thesis is to improve player engagement. A straightforward way to define player engagement is the "continuation desire" to play the game repeatedly during play or over a longer period of time~\cite{schoenau2011player}. The triggers and components of player engagement have been extensively studied in many theoretical frameworks and linked to numerous aspects, such as happiness~\cite{sweetser2005gameflow,flow1990psychology,chen2007flow}, motivations~\cite{przybylski2010motivational,ryan2006motivational,yee2006demographics,yee2006motivations,sherry2006video}, presence~\cite{lombard1997heart,tamborini2006role}, immersion~\cite{mcmahan2003immersion,brown2004grounded,jennett2008measuring,ermi2005fundamental}, pleasure~\cite{costello2009tool}, enjoyment~\cite{ravaja2007fun,klimmt2003dimensions,mekler2014systematic}, fun~\cite{koster2013theory} and playability~\cite{federoff2003improving,federoff2002heuristics,desurvire2004using,nacke2009playability}. On the other hand, empirical studies often focus on concrete measurements of player engagement, such as purchases in the game~\cite{xie2015predicting,sifa2015predicting}, the number of matches played within a time window~\cite{xue2017dynamic,weber2011modeling,}, or churn risk~\cite{hadiji2014predicting,harrison2012players}, i.e., the likelihood of a player not playing any games within a subsequent time frame.
%, not necessarily a permanent churn. 
% We define churn risk as the proportion of total current players who will stop playing the game over a period of time. 

Indicated by numerous theories, match outcomes have a close relationship with player engagement. The pursuit of victory and achievement is a common reason of player engagement~\cite{schoenau2011player,yee2006motivations,sherry2006video,wu2010falling,lazzaro2004we}. Victorious or progressive game outcomes can be seen as one kind of fulfillment of victory and achievement. Also, players look for the level of competitiveness commensurate with their skills. Central to the flow theory proposed by Cs\'{i}kszentimih\'{a}lyi~\cite{sweetser2005gameflow,flow1990psychology,chen2007flow} is the idea that there should be an optimal match between the skills an individual possesses and the challenges presented by an activity. Similarly, competence is one of the three pillars in Self-Determination theory~\cite{przybylski2010motivational,ryan2006motivational}, which refers to people's desire for challenge and feelings of mastery as their intrinsic motivation to engage in the game. Therefore, monotonous match outcomes are not desirable because they indicate consistent over-/under-challenging player experience. 

Empirical studies also indicate that game outcomes are correlated with player engagement, mostly coming from the topics of churn prediction and dynamic difficulty adjustment. On the one hand, data-driven models for predicting churn behaviors often rely on features derived from game outcomes. \cite{weber2011using} build a regression model for predicting the number of games played for each player in a football game, while observing the win ratio of certain game modes are influential in the prediction. Similar application of using game outcomes-derived features for churn prediction models can also be found in~\cite{harrison2012players,xie2015predicting,}. On the other hand, at the heart of dynamic difficulty adjustment is to modulate game difficulty, and subsequently game outcomes, as a means to maintain proper challenge for players~\cite{hunicke2005case}. Researchers have found that quantitative measurement or subjective perception of engagement improves with various difficulty and outcome adjustment mechanisms. In the work by~\cite{hunicke2005case}, the author adjusts supply and demand in a game and finds that expert players report slightly elevated levels of enjoyment. In the work by~\cite{van2009incongruity}, players report to have decreased pleasure and increased frustration when playing harder games compared to balanced games. ~\cite{xue2017dynamic} deploy a difficulty adjustment system to a matching-three game (a game like \textit{Candy Crush}), discovering that difficulty adjustment could bring as much as $7 \sim 9 \%$ improvement in total numbers of rounds played and duration of gameplay.

% This raises the importance to carefully maintain the winning rate for players, especially those inexperienced players who have difficulty of winning a match.

% Churn prediction will serve as an important building component to guide opponent recommendation in our proposed work. Churn prediction has been applied within various disciplines for decades, such as telecommunications \cite{ferreira2004data}, online advertisements \cite{yoon2010prediction} and insurance \cite{morik2004analysing}. Video games have also sparked a number of churn analysis studies. For instance, Weber~et~al. \cite{weber2011modeling} built a regression model to predict the number of games played. They also used the model to aid game design by identifying the most influential features on player retention. Hadiji~et~al. \cite{hadiji2014predicting} established the fundamental in churn prediction in free-to-play (F2P) games by suggesting definitions of various churn behaviors, proposing universal behavioral telemetry, and comparing different machine learning models across five commercial F2P games. Runge~et~al. \cite{runge2014churn} not only trained a churn prediction model for a casual social game but also showed how the game can leverage the model to increase the effectiveness of promotions to players. 

% It is important to note the relationship between our proposed pre-match personalized recommendation techniques and the existing studies on player engagement and match outcomes. The initial item recommendation aims to recommend the optimal initial items to maximize one's win rate, i.e., to influence match outcomes positively to the largest extent. Therefore, it is a direct method to affect match outcomes but needs additional cares if used to improve player engagement. The opponent recommendation uses the player engagement as a criteria to seek personalized opponents and adjust match outcomes. Therefore, it simultaneously affects match outcomes and player engagement.


% \section{Backgrounds of Collectible Card Game}
% We briefly introduce the background for \textit{Collectible Card Games} (CCGs), the testbed for initial item recommendation.

% Each CCG has a fundamental set of rules that describes the players' objectives, the categories of cards used in the game, and the basic rules by which the cards interact. The CCG that we will use is 1-vs-1 and turn-based. In a match of the CCG, two players take turn to make movements. Each player is initialized with certain health points. The victory objective is to destroy the opponent's health by playing the cards in possession. Each player is also initialized with certain mana points. Mana points get refresh in each turn and increase as the game proceeds. One card is drawn from the player's \textit{deck} to his hands at the beginning of his each turn. Deck is a collection of cards that the player selects from an available pool of cards before the match starts. After the draw, the player uses the cards he has drawn to his hands to interact with the game in order to gain an advantage over the opponent. Each card is assigned with a fixed mana cost. When a card is played out of his hands, it costs the designated amount of mana from the player. The player's turn ends when he has no available actions to perform or he voluntarily relinquishes his turn. 

% Each card is associated with effects, attributes and rules to play it. There are two types of cards, \textit{Minion} and \textit{Spell}. Minion cards, when cast from the player's hands, stay in the game helping the player attack and defend until the opponent takes actions to eliminate them. Spell cards will adjust the game environment as per their designated effects, for instance, one-time damage to opponent or his minions, or recover health to the player or his own minions, or summon new minions. 

%Algorithm~1 shows the typical game flow of the CCG. 
%
%\begin{algorithm}
%    \SetKwInOut{Input}{Input}
%
%    \SetKwFunction{Armijo}{armijo} 
%    \Input{$Player 1$, $Player 2$ with their customized decks}
%
%    \BlankLine
%    \While{game not end} {
%    
%    \BlankLine
%    $curPlayer \leftarrow \hahatext{alternate between } Player1 \text{ and } Player 2$ 
%    
%    
%    \BlankLine
%	$curPlayer$ draws one card from own deck  
%  
%   \BlankLine
%    $curPlayer$ uses the cards in hands and in play to interact with the game
%    		
%   \BlankLine 	
%    
%    }
%    \caption{Typical Game Flow of 1-vs-1 Turn-Based CCG}
%\end{algorithm}

% Deck is the initial equipment in CCGs. Because the size of total available cards (usually hundreds or thousands) is much larger than the size of deck (usually a few dozens), CCG players need to strategically customize their decks to take advantage of favorable card interactions, combinations and statistics. However, some inexperienced players have too limited knowledge to construct a competent deck to win a match. This could result in their frustration and eventually disengagement for the game due to the lack of victorious experience~\cite{schoenau2011player,yee2006motivations,sherry2006video,wu2010falling}. 

% A CCG simulator is implemented by us with rules encoded as exactly described. We implemented 200 cards with attributes and abilities taken reference from the cards in a commercial CCG Hearthstone (Blizzard Entertainment, Inc.). However, the exact attributes and abilities are randomly varied to avoid infringement on their intellectual properties. The size of a deck is 30 in the CCG.    


\subsection{Recommendation Systems in Match-Based Video Games}

The tight relationship between game outcomes and player engagement raises the importance to carefully maintain the proper pace of game outcomes that players would experience. One way is to use recommendation system techniques~\cite{medler2011using} to dedicatedly present in-game elements to players such that their in-game decisions and behaviors could be influenced to eventually impact game outcomes.

Recommendation systems have been studied for long in a variety of web applications such as movies~\cite{amatriain2012netflix}, e-commerce~\cite{linden2003amazon} and news~\cite{das2007google}. The video game industry has also used recommendation systems to introduce players games that they are likely to enjoy~\cite{sifa2014archetypal,orland10,skocir2012mars,wu2017recommendation}. These recommendation systems serve as information filtering methods to alleviate information overload faced by users, as users are not able to go through all candidate items usually in a great amount within those web applications. To this end, these traditional recommendation systems predict users' preferences on items accurately such that personalized item recommendations can be given based on the ranking of user preference predictions~\cite{liang2006personalized}. 

Video games as the form of interactive entertainment allow game developers apply recommendation systems not only for recommending next games, but also in-game elements within a game. In this thesis, we focus on recommendation systems for in-game elements within match-based video games which have distinctive features than traditional recommendation systems introduced in the previous paragraph. First, our goal is centering on predicting in-game elements' influences on game outcomes rather than players' preferences on those in-game elements. Second, in-game element recommendations to one player may affect other players' experience. Therefore, in-game element recommendations have to consider other players' information. This is contrastive to traditional recommendation systems where recommended items to one user are relatively independent to other users' experience.

Although recommendation systems have been utilized on a variety of in-game elements for various purposes~\cite{kolen2018horizontal,wu2017recommendation}, those sharing the same scope as this thesis have only sporadic appearances in literature (i.e., in-game starting item, character, and opponent recommendations in match-based games for influencing game outcomes and player engagement). 
Our suspicion for lacking of research in this scope is that accessing to data of large-scale commercial games which have sufficiently sophisticated in-game elements for applying recommendation system techniques is not always easy. The difficulty may drive academic research to focus only on a few publicly accessible datasets or games with a smaller scale of which researchers can have full control. Nevertheless, we survey existing works as follows.

% (e.g., starting gifts in Dark Soul and starting weapons in Bloodborne)
Starting items are commonly seen elements in a variety of genres of games, such as Action Role-Playing and Multi-Player Online Arena, where starting items help in-game characters heal, scout, defend, and attack when characters are weak in their initial stages, and Collectible Card Games, where starting items refers to a set of cards, called a \textit{deck}, upon which players' in-game abilities and strategies will depend. Some games have incorporated starting item recommendation features; for instance, when making purchases of starting items in League of Legends, players can browse the full list of all items or a short list of recommended items for easier choices. Despite the prevalence of starting items, to our best knowledge, we have only seen academic research in deck building and recommendation for Collectible Card Games, which are mainly search algorithms using either heuristic searches or metaheuristic searches~\cite{birattari2009tuning}. Heuristic search methods decide which cards to include in a deck based on domain heuristics such as popularity and in-game resource curve~\cite{frankkarsten,willfancher,stiegler2016hearthstone}. However, heuristic methods require in-depth human knowledge and lack flexibility to adapt to different play styles and opponents. Therefore they are suitable to deploy for large-scale personalized deck recommendation. The other category is metaheuristic search, referring to high-level, problem-independent, approximate search strategies for tackling optimization problems~\cite{birattari2009tuning}. Researchers have used one type of metaheuristic search called \textit{Genetic Algorithm} (GA)~\cite{holland1992adaptation} to evolve decks towards higher winning-effectiveness through repeated modifications and selections~\cite{garcia2016evolutionary,bjorke2017deckbuilding}. Although metaheuristic search algorithms do not require human knowledge to guide searches, they require a large computational cost for simulation-based evaluation on intermediate solutions, making them unsuitable for providing large-scale responsive recommendations either. In Chapter~\ref{chapter:qdeckrec}, we will illustrate the details of how such inefficiency of metaheuristic searches arises and propose a more efficient deck building algorithm for deck recommendation in large-scale or real-time application. 


To our best knowledge, we have not seen any existing opponent recommendation method that formally treats the opponent recommendation task as an optimization problem to maximize player engagement. In practice, the concept of opponent recommendation is often implemented as matchmaking services which connect players to form PvP matches. A fair amount of matchmaking systems simply assume that skill balanced games are good for engagement \cite{graepel2006ranking,sweetser2005gameflow,flow1990psychology,chen2007flow} and hence resort to skill rating algorithms~\cite{glickman1999parameter,elo1978rating,herbrich:trueskill} to identifying similarly skilled opponents. My\'{s}lak and Deja \cite{myslak2014developing} suggests additional information about player preferences in in-game avatar roles can further improve fairness-based matchmaking systems. A few researchers have explored methods to improve player engagement through matchmaking. Delalleau et al. \cite{Delalleau2012} proposed to train a neural network based architecture which predicts player enjoyment based on their historical statistics. They measured enjoyment by directly asking players for feedback after each match. However, their enjoyment-based matchmaking has not been verified in real games. Plus, whether players are willing to give feedback about enjoyment and how reliable their feedback would be are questionable. Jim{\'e}nez-Rodr{\i}guez et al. \cite{jimenez2011matchmaking} proposed that matchmaking could be based on preferred roles by players. They argue that a fun match should have players act in  roles with perceivably joyful role distribution. However, it is still a conceptual, heuristic-based method without experiment showing that such matchmaking system indeed improves concrete engagement metrics.

We note certain interconnectivity between in-game element recommendation systems and other well-known adaptive techniques applied in video games~\cite{bakkes2012personalised,chen2015analytics} which may not be commonly phrased as "recommendation systems". These adaptive techniques include: (1) \textit{Procedural Content Generation} (PCG) for algorithmically generating in-game content tailored to player experience~\cite{yannakakis2011experience,togelius2011search}; and (2) \textit{Dynamic Difficulty Adjustment} (DDA)~\cite{hunicke2005case} and matchmaking~\cite{Delalleau2012,herbrich:trueskill} for identifying human opponents, Non-Player Character (NPC) and game environments suitable for the player's skill. These adaptive techniques are essentially based on some form of prediction on how well the player would accommodate to their adaption. Although the adaption is usually implicitly integrated in the game such that the player is not offered the choice of selecting what specific adaption to receive, I still treat these adaptive techniques as (special cases of) in-game element recommendation systems, because they technically reside in the original definition of recommendation systems as information filtering systems based on prediction of some form of score for user-item pairs~\cite{isinkaye2015recommendation,bobadilla2013recommender,resnick1997recommender,adomavicius2005toward}. 

The starting item and character recommendation systems we want to focus on in this thesis (see overview in Chapter~\ref{sec:thesis_overview}) do not belong to PCG because we try to recommend these in-game elements which have been generated already in the pre-match stage: our goal is to offer recommendations to ease players' selection on these in-game elements possibly in an overwhelming amount. On the other hand, our opponent recommendation system can be used exactly a matchmaking system. 


% Various recommendation techniques have been applied in both stages. For example, in the pre-match stage, opponents can be recommended to match the player's skill level in order to make games sufficiently challenging~\cite{sweetser2005gameflow,flow1990psychology,chen2007flow} and winning-effective characters, starting items. In the in-match stage, tactical and strategical hints suitable to players knowledge level~\cite{weber2009data,cunha2014rtsmate} can be recommended in order to help players with difficulty of winning the match and prevent disengagement from frustrating experience~\cite{schoenau2011player}.

% We will use two subsections to discuss the state-of-the-arts in initial item recommendation and opponent recommendation.


% \subsubsection{Deck Recommendation}~\label{deckrec_prev}
% Deck recommendation is a novel topic which have been studied by only a few works. The existing works can basically be divided into two directions. First, intuition-driven methods decide which cards to be included based on the popularity of cards from collected historical data~\cite{frankkarsten,willfancher}. The underlying intuition is that popularly used cards are very likely to be strong ones as a result people favor them. However, these methods do not guarantee the assembled deck of the most popular cards is competitive. Stiegler et al.~\cite{stiegler2016hearthstone} propose a utility system to search deck with more types of game-specific heuristics added besides card popularity, including mana curve, strategic parameters, cost effectiveness and card synergies. However, all intuition-driven methods are manually heavy and not easy to transfer to other games intelligently. Second, Garc{\'\i}a-S{\'a}nchez et al.~\cite{garcia2016evolutionary} proposed to use Evolutionary Algorithm~\cite{simon2013evolutionary} to iteratively modify decks and select ones with faithful fitness values imitating the process of natural evolution. The fitness value is the average win rate of the candidate deck pitting against a few common used decks while a default, greedy-based AI is used for both sides in every match. However, the limitation of their method is that a deck's strength may not be completely realized by just using the universal, greedy-based AI as used in the fitness value evaluation. Moreover, the evolution of candidate decks is currently totally random
% rather than following some logical sense similar to human players. For example, rather than randomly replacing a card with another card, they do not want to break good card combinations or replace a card with a similar but much weaker one. As a result, the fitness landscape in the current EA algorithm~\cite{garcia2016evolutionary} is quite agitated and the process to find an ideal deck requires a large computational cost. Furthermore, the EA-based deck recommendation is not reusable. Each time a deck is asked to recommend, the EA-based deck recommendation has to restart the whole process of evolution without any prior deck search experience transferred. Therefore, the EA-based algorithm is not a practical implementation if deck recommendation needs to be requested in a large scale. For example, game companies might want to implement a deck recommendation API to serve a large population of new players.


 



